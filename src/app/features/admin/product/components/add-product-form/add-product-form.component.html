<div class="product-form-wrap">
  <div class="close-dialog">
    <button mat-icon-button aria-label="close dialog" mat-dialog-close>
      <mat-icon>close</mat-icon>
    </button>
  </div>
  <h2 mat-dialog-title class="dialog-title">Product form</h2>
  <div class="form-container">
    <form [formGroup]="productForm" (submit)="saveProduct()">
      <div class="row">
        <div class="input-container">
          <mat-form-field appearance="outline">
            <mat-label>Product name</mat-label>
            <input
              matInput
              placeholder="Enter product name"
              required
              formControlName="name"
            />
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Product price</mat-label>
            <input
              matInput
              type="number"
              placeholder="Enter product price"
              required
              formControlName="price"
            />
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Category</mat-label>
            <mat-select formControlName="categoryId">
              <ng-container *ngFor="let category of categories$ | async">
                <mat-option [value]="category.id">{{
                  category.name
                }}</mat-option>
              </ng-container>
            </mat-select>
          </mat-form-field>
        </div>
        <div
          class="drag-and-drop-area"
          appDragDropFileUpload
          (fileDropped)="onFileDropped($event)"
        >
          <input
            type="file"
            #fileDropRef
            id="fileDropRef"
            multiple
            (change)="fileBrowseHandler($event)"
          />
          <img src="assets/icons/drag-and-drop.svg" alt="drag-and-drop" />

          <h3>Drag and drop file here</h3>
          <h3>or</h3>
          <label for="fileDropRef">Browse for file</label>
        </div>
      </div>

      <mat-form-field appearance="outline" class="text-area">
        <mat-label>Textarea</mat-label>
        <textarea matInput rows="10" formControlName="description"></textarea>
      </mat-form-field>
      <br />
      <button
        mat-button
        color="primary"
        class="add-product-btn submit"
        [disabled]="(isLoading$ | async) || productForm.invalid"
      >
        Submit
      </button>
    </form>

    <div class="image__list">
      <div class="image__container" *ngFor="let file of files; let i = index">
        <div class="image__content">
          <ng-container *ngIf="photoControl!.value[i] as value; else noImage">
            <img [src]="value.url" alt="file" width="160" height="160" />
          </ng-container>
          <ng-template #noImage>
            <img
              src="assets/icons/no-file.svg"
              alt="file"
              width="160"
              height="160"
            />
          </ng-template>
          <div class="info">
            <h4 class="image__name">
              {{ file.name }}
            </h4>
            <p class="image__size">
              {{ file.size | fileFormat}}
            </p>
          </div>

          <button
            *ngIf="photoControl!.value[i] as value"
            mat-icon-button
            aria-label="delete"
            class="image__delete-btn"
            (click)="deleteImage(value)"
          >
            <mat-icon>delete</mat-icon>
          </button>
        </div>

        <app-progress
          *ngIf="!photoControl!.value[i]"
          [progress]="file.progress$ | async"
        ></app-progress>
      </div>
    </div>
  </div>
</div>
